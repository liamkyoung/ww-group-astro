---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";
import { getAllPosts } from "../../lib/queries/posts";
import { urlFor } from "../../lib/sanityImage";
import Default from "@/layouts/Default.astro";

const posts = await getAllPosts();

if (!posts) {
  throw new Error(`No posts found: ${posts}`);
}
---

<Default>
  {
    posts.map((post) => (
      <li>
        <a href={`/news/${post.slug.current}/`}>
          {post.mainImage && (
            <Image
              width={720}
              height={360}
              src={urlFor(post.mainImage).url()}
              alt={post.title}
            />
          )}
          <h4 class="title">{post.title}</h4>
          <p class="date">
            <FormattedDate date={new Date(post.publishedAt)} />
          </p>
        </a>
      </li>
    ))
  }
</Default>

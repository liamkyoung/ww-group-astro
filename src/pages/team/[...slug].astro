---
import Default from "@/layouts/Default.astro";
import { getAllTeammateSlugs, getTeammateBySlug } from "@/lib/queries/teammate";
import type { Teammate } from "@/globals/types/teammate"; // adjust path as needed
import SocialIcon from "@/components/SocialIcon.astro";
import { portableTextToHtml } from "@/lib/portableText";
import { urlFor } from "@/lib/sanityImage";
import TeammateHero from "@/components/Hero/TeammateHero.astro";
import ContactAndBio from "@/components/ContactAndBio.astro";

// Build all static paths at build-time
export async function getStaticPaths() {
  const slugs = await getAllTeammateSlugs();

  return slugs.map((slug) => ({
    params: { slug },
    props: { slug }, // optional but handy
  }));
}

const { slug } = Astro.params;
const teammate = await getTeammateBySlug(slug as string);

if (!teammate) {
  // You can also render a custom 404 layout instead of throwing
  throw new Error(`Teammate not found for slug: ${slug}`);
}

// Destructure what you'll likely use
const {
  title,
  jobTitle,
  profilePic,
  profileIntroduction,
  bioParagraph,
  strengths,
  yearsOfExperience,
  phoneNumber,
  officeNumber,
  email,
  instagram,
  facebook,
  linkedin,
} = teammate;

// TODO: when you wire image URLs, use your urlFor() helper or sanity-image-url here.

const bioHtml = portableTextToHtml(bioParagraph);
---

<!-- interface Props {
  name: string;
  jobTitle: string;
  shortDescription: string;
  yearsOfExperience?: number;
  strength?: string;
  fullBodyImage?: SanityImage | null;
  backHref?: string; // defaults to /team
} -->
<Default>
  <section class="global-margin-x my-24 space-y-12">
    <TeammateHero
      name={title}
      jobTitle={jobTitle}
      shortDescription={profileIntroduction}
      yearsOfExperience={yearsOfExperience}
      strength={strengths}
      fullBodyImage={profilePic}
    />
    <ContactAndBio
      email={email}
      phoneNumber={phoneNumber}
      officeNumber={officeNumber}
      linkedin={linkedin}
      instagram={instagram}
      facebook={facebook}
      bioHtml={bioHtml}
    />
  </section>
</Default>
